#!/usr/bin/env python3
"""
Script para diagnosticar el estado de las ubicaciones GBP y limpiar datos obsoletos
"""

def main():
    print("üîç DIAGN√ìSTICO: Problema de ubicaciones GBP obsoletas")
    print()
    print("üìä Los errores muestran que:")
    print("   ‚ùå Todas las ubicaciones GBP est√°n dando error 404 (no existen)")
    print("   ‚ùå Las im√°genes de Facebook dan 403 (inaccesibles)")
    print("   ‚ùå No quedan ubicaciones activas para publicar")
    print()
    print("üõ†Ô∏è SOLUCI√ìN: Necesitas actualizar las ubicaciones GBP")
    print()
    print("1Ô∏è‚É£ Primero, ejecuta este SQL para ver el estado actual:")
    print()
    print("-- Ver ubicaciones que est√°n marcadas como activas")
    print("SELECT COUNT(*) as ubicaciones_activas FROM gbp_locations WHERE activa = true;")
    print()
    print("-- Ver cu√°ntas se marcaron como inactivas hoy")
    print("SELECT COUNT(*) as marcadas_inactivas_hoy")
    print("FROM gbp_locations") 
    print("WHERE activa = false")
    print("  AND updated_at >= CURRENT_DATE;")
    print()
    print("-- Ver empresas sin ubicaciones activas")
    print("SELECT fp.empresa_id, COUNT(gl.location_name) as ubicaciones_activas")
    print("FROM facebook_paginas fp")
    print("LEFT JOIN gbp_locations gl ON fp.empresa_id = gl.empresa_id AND gl.activa = true")
    print("WHERE fp.publicar_en_gbp = true")
    print("GROUP BY fp.empresa_id")
    print("HAVING COUNT(gl.location_name) = 0;")
    print()
    print("2Ô∏è‚É£ Para limpiar los datos problem√°ticos:")
    print()
    print("-- Marcar TODAS las ubicaciones como inactivas (reset completo)")
    print("UPDATE gbp_locations SET activa = false WHERE activa = true;")
    print()
    print("-- Deshabilitar publicaci√≥n GBP hasta que tengas ubicaciones v√°lidas")
    print("UPDATE facebook_paginas SET publicar_en_gbp = false WHERE publicar_en_gbp = true;")
    print()
    print("3Ô∏è‚É£ Alternativa m√°s segura - Solo procesar publicaciones sin imagen:")
    print()
    print("üí° ¬øQuieres que modifique el job para que:")
    print("   ‚úÖ Solo procese publicaciones de TEXTO (sin im√°genes)")
    print("   ‚úÖ Solo use las pocas ubicaciones GBP que a√∫n funcionan")
    print("   ‚úÖ Evite todos los errores de im√°genes y ubicaciones inv√°lidas")

if __name__ == "__main__":
    main()